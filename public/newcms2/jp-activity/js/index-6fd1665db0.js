$(function(){var a=$("#login"),e=a.find(".login-btn"),t=$(".userSec"),d=$("#scoreModal"),r=$("#prize-info-fill"),c=!0,l=0,o=null,s=!0,f=null,n=0,p=0,u={type:1,id:0,callbackFn:null},m=[window.wxShareSuccessFlag=!1,!1,!1,!1,!1,!1],i=new Date("2018/07/23 23:59:59"),h=new Date("2018/07/24 23:59:59"),g=bn_utils.getLocalStore("token")||"",w=(bn_utils.getLocalStore("user_id"),bn_utils.getLocalStore("user_name")||"");function _(){initBaseInfo(function(e){e=e;var i=$(".taskList"),n=$(".turntable .lottery");if(e.Task.Is_AppWebEnter&&i.find(".day-login").text("完成"),e.Task.Is_AppWebEnter_6&&i.find(".daypay-6").text("完成"),e.Task.Is_JpTaskRecord&&(i.find(".share").text("完成"),window.wxShareSuccessFlag=!0),e.Task.Is_AppWebEnter_98&&i.find(".daypay-98").text("完成"),e.Task.Is_AppWebEnter_648&&i.find(".daypay-648").text("完成"),l=e.SurplusNum<=0?0:e.SurplusNum,n.find(".surplus-lottery-num").text(l),n.find(".current-integral").text(e.integral),p=e.integral,wxConf(function(e){wx.config({beta:e.beta,debug:e.debug,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:e.jsApiList,url:e.url}),wx.ready(function(){wx.onMenuShareTimeline({title:"九品小县令狂欢盛典活动",link:location.href,imgUrl:"https://www.310game.com/newcms2/jp-activity/images/offical-icon.png",success:function(){if(window.wxShareSuccessFlag)return!1;wxShareSuccess(function(e){"OK"==e.message&&(l+=1,window.wxShareSuccessFlag=!0,$(".surplus-lottery-num").text(l),$(".taskList .share").text("完成"))})},cancel:function(){}}),wx.onMenuShareAppMessage({title:"九品小县令狂欢盛典活动",desc:"狂欢转转转，豪礼拿不断",link:location.href,imgUrl:"https://www.310game.com/newcms2/jp-activity/images/offical-icon.png",type:"link",dataUrl:"",success:function(){if(window.wxShareSuccessFlag)return!1;wxShareSuccess(function(e){"OK"==e.message&&(l+=1,window.wxShareSuccessFlag=!0,$(".surplus-lottery-num").text(l),$(".taskList .share").text("完成"))})},cancel:function(){}})})}),!e.exchange_list)return!1;for(var t=0,a=m.length;t<a;t++)m[t]=e.exchange_list.some(function(e){return e==t});$(".gift-change-rule .score").each(function(e,i){m[e]&&$(i).addClass("score-unclick")})})}function b(e){if((e=JSON.parse(e)).status){var i=e.data.token,n=e.data.user_id;g=i,bn_utils.storeToLocal("token",i),bn_utils.storeToLocal("user_id",n),bn_utils.storeToLocal("user_name",w),a.fadeOut(),t.find(".login span").text("欢迎您，"+w),t.find(".loginOut").show(),t.find(".giftRocord").show(),$(".downloadTip").hide(),_()}else w="",bn_utils.tipModal("fail",e.msg),"验证码错误"==e.msg.replace(/\d+/g,"")&&$("#captcha").attr("src",this.src="https://www.310game.com/user?action=captcha&r="+Math.random())}g&&(t.find(".login span").text("欢迎您，"+w),t.find(".loginOut").show(),t.find(".giftRocord").show(),$(".downloadTip").hide(),_()),$(".login").on("click",function(){if(g)return!1;a.fadeIn()}),e.on("click",function(){var e=a.find(".user-account input").val().trim(),i=a.find(".user-pwd input").val().trim(),n=a.find(".user-checkcode input").val().trim();if(!e.length)return bn_utils.tipModal("fail","账号不能为空！"),!1;if(0==i.length)return bn_utils.tipModal("fail","密码不能为空！"),!1;if(i.length<6)return bn_utils.tipModal("fail","密码错误！"),!1;if(0==n.length)return bn_utils.tipModal("fail","验证码为空！"),!1;if(n.length<4)return bn_utils.tipModal("fail","请输入正确的验证码！"),!1;var t={username:w=e,password:i,login_type:"bn",captcha:n,isAutoLoginCheckBox:!1};$.post("https://www.310game.com/user?action=login",t,b)}),t.find(".loginOut").on("click",function(){bn_utils.storeToLocal("token",""),bn_utils.storeToLocal("user_id",""),bn_utils.storeToLocal("user_name",""),location.href=location.href});var x=$(".lottery .lottery-pointer"),v=["5","iPadmini 4","50","冰鸟抱枕","10","线下见面会","20","100","iPhone X"],y=[340,20,60,100,140,180,220,260,300];function k(e){var o,i,r,n=(36*Math.random()+y[e.data]+2)%360+1080;i=n,r=(o=e).data,x.css("transform","rotate(0deg)"),setTimeout(function(){x.addClass("lottery-pointer-ani"),x.css({transform:"rotate("+i+"deg)"})},100),setTimeout(function(){if(x.removeClass("lottery-pointer-ani"),c=!0,0!=r&&2!=r&&4!=r&&6!=r&&7!=r||(d.fadeIn(),d.find(".score-count").text(v[r]),p+=v[r]-0,$(".current-integral").text(p)),1==r||3==r||8==r){var e=3,i=o.exchange_record.id,n=v[r],t={real_name:"",phone:"",address:"",email:""};F(e,i,n,t,S)}if(5==r){var e=4,i=o.exchange_record.id,n=v[r],t={real_name:"",phone:"",address:"",email:""};F(e,i,n,t,S)}var a=$(".surplus-lottery-num");(l-=1)<=0?a.text(0):a.text(l)},3e3)}function S(e){bn_utils.tipModal("success",e.message)}d.find(".scoreModal-btn").on("click",function(){d.fadeOut()}),x.on("click",function(){return Date.parse(i)<Date.now()?(C("<p>非常抱歉，活动已结束，感谢您的参与</p>",function(){$(this).off("click"),$("#confirm-info-modal").fadeOut()},!1),!1):!!c&&(g?A()?l<=0?(C("<p>您的抽奖次数已用完</p>",function(){$(this).off("click"),$("#confirm-info-modal").fadeOut()},!1),!1):(c=!(s=!0),void lotteryReq(k)):(C("<p>请大人在09:00-23:59参与抽奖活动</p>",function(){$(this).off("click"),$("#confirm-info-modal").fadeOut()},!1),!1):(bn_utils.tipModal("fail","您还未登录！"),!1))});new Swiper(".winninSlide",{initialSlide:0,autoplay:1e4,direction:"vertical",slidesPerView:1,noSwipingClass:"stop-swiping",loop:!0});$(".toTop").on("click",function(){window.bn_utils.scrollToTop()}),window.bn_utils.isWeiXin()&&"Android"==window.bn_utils.judgeClient()?$(".download-btn").attr("href",'javascript:alert("请点击右上角“···”使用浏览器打开下载。");'):$(".download-btn").attr("href","https://tg.ibingniao.com/fly/wjlss01da6"),$(".download-btn").on("click",function(){$(this).data("url")}),$(".close").on("click",function(){$(this).parents(".bn-box-com").fadeOut()});var O=$(".foot-nav-list");function z(e){var n="",i=$("#score-record").find(".record-item");if(i.children().remove(),e.reverse(),$.each(e,function(e,i){2==i.prize_type&&(n+='<div class="flex-btw-cen"><span>'+i.created_at.split(" ")[0].replace(/-/g,".")+"</span><span>-"+i.integral+"积分</span><span>兑换"+i.exchange_name+"</span></div>"),5==i.prize_type&&(n+='<div class="flex-btw-cen"><span>'+i.created_at.split(" ")[0].replace(/-/g,".")+"</span><span>+"+i.integral+"积分</span><span>抽奖</span></div>")}),!n)return!1;i.append(n)}O.find(".wx").on("click",function(){$("#attention-wx-official").fadeIn()}),O.find(".share").on("click",function(){$("#share").fadeIn()}),$(".score-record-btn").on("click",function(){if(!g)return bn_utils.tipModal("fail","您还未登录！"),!1;$("#score-record").fadeIn(),lotteryRecord(z)});var M=$("#award-record");function T(e){var n="";if(e.reverse(),$.each(e,function(e,i){2==i.prize_type&&(n+="<tr><td>"+i.created_at.split(" ")[0].replace(/-/g,".")+'</td><td class="copyCode" data-clipboard-text="'+i.cdk_code+'"><span>'+i.cdk_code+"</span></td><td>消耗"+i.integral+"积分兑换</td></tr>"),3==i.prize_type&&(n+="<tr><td>"+i.created_at.split(" ")[0].replace(/-/g,".")+"</td><td>"+i.exchange_name+'</td><td data-id="'+i.id+'" data-address="'+(i.receiving_address||"")+'" data-exchangename="'+i.exchange_name+'" data-prizeType="'+i.prize_type+'" data-phone="'+i.phone+'" data-name="'+(i.real_name||"")+'" class="fill-addr"><a href="javascript:;">点击填写详情</a></td></tr>'),4==i.prize_type&&(n+="<tr><td>"+i.created_at.split(" ")[0].replace(/-/g,".")+"</td><td>"+i.exchange_name+'</td><td data-id="'+i.id+'" data-email="'+i.mailbox+'" data-prizeType='+i.prize_type+"data-phone="+i.phone+" data-name="+i.real_name+' class="fill-addr"><a href="javascript:;">点击填写详情</a></td></tr>')}),!n)return!1;M.find("table").append(n)}function j(e){bn_utils.tipModal("success",e.message),r.fadeOut(),s||(f.data("name",o.real_name),f.data("phone",o.phone),f.data("address",o.address),f.data("email",o.email))}function I(e){e.hasOwnProperty("data")?(C('<div style="text-align:left;padding-left: 1.3rem;"><p style="margin: .3rem 0;" class="copyCode" data-clipboard-text="'+e.data.code+'">礼包兑换码：<span>'+e.data.code+"</span></p><p>请在游戏中进行兑换该礼包，大人可</p><p>在【奖励记录】中查看礼包码。</p>",function(){$(this).off("click"),$("#confirm-info-modal").fadeOut()},!1),p-=n,$(".current-integral").text(p),$($(".gift-change-rule .score")[window.exchangePrizeid]).addClass("score-unclick")):bn_utils.tipModal("fail",e.message)}function L(){var e=window.exchangePrizeid;scoreExchange(e,I),$(this).off("click"),$("#confirm-info-modal").fadeOut()}function C(e,i,n){var t=$("#confirm-info-modal");t.fadeIn(),t.find(".confirm-tip-l").show(),t.find(".confirm-tip-r").show(),t.find(".confirm-tip-content").html(e),"function"==typeof i?t.find(".confirm-btn").on("click",i):t.find(".confirm-tip-l").hide(),n?t.find(".return-btn").on("click",function(){t.fadeOut("normal",function(){t.find(".return-btn").off("click"),t.find(".confirm-btn").off("click")})}):t.find(".confirm-tip-r").hide()}function F(e,i,n,t,a,o){u.type=e,u.id=i,u.exchange_name=n,u.callbackFn=a,r.find(".user-name input").val(t.real_name||""),r.find(".user-phone input").val(t.phone||""),r.find(".user-addr input").val(t.address||""),r.find(".user-email input").val(t.email||""),r.fadeIn(),r.find(".prize-confirm-btn").show(),r.find("input").attr("readOnly",!1),3==e&&(r.find(".object").show(),r.find(".player-meet").hide(),r.find(".modify-tip").hide(),r.find(".object-tit").text(n)),4==e&&(r.find(".object").hide(),r.find(".modify-tip").hide(),r.find(".player-meet").show()),o&&(t.real_name?(r.find("input").attr("readOnly",!0),3==e&&r.find(".player-meet").hide(),4==e&&r.find(".object").hide(),r.find(".object-tip").hide(),r.find(".player-meet-tip").hide(),r.find(".modify-tip").show(),r.find(".prize-confirm-btn").hide()):(3==e&&(r.find(".object").show(),r.find(".player-meet").hide(),r.find(".modify-tip").hide(),r.find(".object-tit").text(n)),4==e&&(r.find(".object").hide(),r.find(".modify-tip").hide(),r.find(".player-meet").show()),r.find(".prize-confirm-btn").show()))}function P(){userInfoFill(o,u.callbackFn),r.fadeOut(),$(this).off("click"),$("#confirm-info-modal").fadeOut()}function A(){var e=Date.now(),i=(new Date).setHours(9,0,0),n=(new Date).setHours(23,59,59);return i<e&&e<n}$(".giftRocord").on("click",function(){lotteryRecord(T),M.find("table").children().remove(),M.fadeIn()}),M.on("click",".fill-addr",function(){var e=$(this),i=e.data("prizetype"),n=e.data("id"),t=e.data("exchangename"),a={};a.real_name=e.data("name"),a.phone=e.data("phone"),a.address=e.data("address"),a.email=e.data("email"),f=e,s=!1,3==i&&F(i,n,t,a,j,!0),4==i&&F(i,n,t,a,j,!0)}),$(".gift-change-rule .score").on("click",function(){var e=$(this);if(Date.parse(h)<Date.now())return C("<p>非常抱歉，活动已结束，感谢您的参与</p>",function(){$(this).off("click"),$("#confirm-info-modal").fadeOut()},!1),!1;if(!g)return bn_utils.tipModal("fail","您还未登录！"),!1;if(!A())return C("<p>请大人在09:00-23:59进行积分兑换</p>",function(){$(this).off("click"),$("#confirm-info-modal").fadeOut()},!1),!1;if(e.hasClass("score-unclick"))return C('<div style="text-align: left;padding-left: 1rem;"><p>每个礼包每天只可兑换一次，请大人</p><p>重新选择需要兑换的礼包~</p></div',function(){$(this).off("click"),$("#confirm-info-modal").fadeOut()},!1),!1;if(n=e.text().replace(/[^\d]/gi,"")-0,p<n)return C("<p>积分不足，无法兑换该礼包。</p>",function(){$(this).off("click"),$("#confirm-info-modal").fadeOut()},!1),!1;window.prizeName=e.prev().find(".gift-name").text(),window.exchangePrizeid=e.data("id");var i="";window.exchangePrizeid<=2&&(i='<div style="text-align:left;padding-left: 1.3rem;"><p>确认消耗'+n+"积分兑换以下道具吗？</p><p>兑换道具："+window.prizeName+"</p></div>"),3==window.exchangePrizeid&&(i='<div style="text-align:left;padding-left: .3rem;font-size: .32rem"><p style="margin: .3rem 0;">确认消耗'+n+"积分兑换以下道具吗？</p><p>兑换道具：卷轴礼包 * 1 ,书籍经验包 * 1 ,技能经验包 * 1 ,</p><p>技能经验书 * 2 ,书籍经验书 * 2</p></div>"),4==window.exchangePrizeid&&(i='<div style="text-align:left;padding-left: .6rem;font-size: .32rem"><p style="margin: .3rem 0;">确认消耗'+n+"积分兑换以下道具吗？</p><p>兑换道具：翰林令牌 * 1 ,翡翠心 * 5 ,书籍经验包 * 2 ,</p><p>政绩礼包 * 1 ,魅力香囊 * 1 ,亲密香囊 * 1</p></div>"),5==window.exchangePrizeid&&(i='<div style="text-align:left;padding-left: .6rem;font-size: .32rem"><p style="margin: .3rem 0;">确认消耗'+n+"积分兑换以下道具吗？</p><p>兑换道具：政绩礼盒 * 1 ,百宝袋 * 1 ,翰林令牌 * 1 ,</p><p>卷轴礼包 * 2 ,亲密香囊 * 2 ,魅力香囊 * 2 ,书籍经验包 * 2</p></div>"),C(i,L,!0)}),$("#confirm-info-modal .close").on("click",function(){var e=$(this).parents("#confirm-info-modal");e.find(".confirm-btn").off("click"),e.find(".return-btn").off("click")}),r.find(".prize-confirm-btn").on("click",function(){var e=r.find(".user-name input").val().trim(),i="";if(!e)return bn_utils.tipModal("fail","姓名不能为空"),!1;var n=r.find(".user-phone input").val().trim();if(1!=bn_utils.checkPhoneFormat(n))return bn_utils.tipModal("fail","手机号码填写有误"),!1;if(3==u.type){var t=r.find(".user-addr input").val().trim();if(!t)return bn_utils.tipModal("fail","地址不能为空"),!1}if(4==u.type&&(i=r.find(".user-email input").val().trim(),1!=bn_utils.checkEmailFormat(i)))return bn_utils.tipModal("fail","输入邮箱有误"),!1;var a={phone:n,address:t||"",exchange_name:u.exchange_name,id:u.id||"",mailbox:i||"",real_name:e};o=a;C("<p>信息填写后将无法修改,请确认您的</p><p>信息是否正确,点击返回可修改信息</p>",P,!0)}),r.find(".info-close").on("click",function(){if(r.show(),s){C("<p>您尚未填写个人信息，是否确认离开该页面？</p><p>您可在【奖励登录】处完成个人信息填写。</p>",function(){r.fadeOut(),$(this).off("click"),$("#confirm-info-modal").fadeOut()},!0)}else r.fadeOut()});var D=new ClipboardJS(".copyCode");D.on("success",function(e){bn_utils.tipModal("success","复制成功！"),e.clearSelection()}),D.on("error",function(e){})});